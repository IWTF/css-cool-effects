<!DOCTYPE html>
<html>

<head>
	<title>弹幕效果</title>
	<link rel="stylesheet" href="./barrage.css">
</head>

<body>
	<div class="page" id="page"></div>
</body>
<script type="text/javascript">
	const dmData = [{
		"id": 786,
		"sex": 1,
		"content": "我今年23岁，老家在安徽，目前在北京工作，独立、善良、孝顺都是我的优点。比较喜欢有担当，有主见的男生，如果他再有点小幽默就更好了，还有身高不要低于175cm。如果有合适的小哥哥，我么可以聊聊啊~",
		"zanNumber": 27
	}, {
		"id": 854,
		"sex": 1,
		"content": "我是山东人，现在在上海工作，在异乡漂泊真的很孤独，很想有个人能陪伴我。过完年我就27岁了，性格比较内向，想找一个能读懂我内心的人，哪儿人都可以，年龄不要相差太大，奔着结婚去的，我很真诚，希望你也能够认真真诚。",
		"zanNumber": 14
	}, {
		"id": 1022,
		"sex": 1,
		"content": "年芳27湖南人氏",
		"zanNumber": 14
	}, {
		"id": 1103,
		"sex": 1,
		"content": "我是广东的妹子，喜欢旅游，性感比较开朗，想找个顾家，宠老婆，又东浪漫的男朋有，希望在着遇到有缘人～",
		"zanNumber": 10
	}, {
		"id": 1005,
		"sex": 0,
		"content": "本人男，30岁了，北京人，有车有房，想找个漂亮的四川妹子，聊聊看",
		"zanNumber": 7
	}, {
		"id": 1214,
		"sex": 1,
		"content": "湖北人 在北京工作。今年27 我是你的前女友 也曾拯救过地球 身高刚好169 快来找我复合吧。我不是颜控 喜欢有才华 有爱心 幽默的男生，身高175以上。理想型 李诞 一样的诗人\uD83D\uDC7B",
		"zanNumber": 6
	}, {
		"id": 1207,
		"sex": 1,
		"content": "我今年25岁，是来自东北的妹子。平时喜欢美食、看书，想找一个178cm以上，白白净净的男生。",
		"zanNumber": 5
	}, {
		"id": 1227,
		"sex": 1,
		"content": "我是川妹子今年23岁~目前在北京打工，做酒店行业的，平时除了工作一个人比较孤单，想找个聊得来的小哥哥，一起回家过年",
		"zanNumber": 4
	}, {
		"id": 1206,
		"sex": 1,
		"content": "我是河北人，目前在北京工作，刚毕业，想找个有稳定工作的男朋友，颜值不必很高，有眼缘就行，但是一定要有责任心，奔着结婚去的，非诚勿扰哈～",
		"zanNumber": 3
	}, {
		"id": 799,
		"sex": 0,
		"content": "我是江西男孩。今年28岁，在一个公司上班。找一个温柔体贴的女",
		"zanNumber": 10
	}, {
		"id": 859,
		"sex": 0,
		"content": "湖南人在广州，找个过圣诞的妹子，最好以后每个圣诞一起过！",
		"zanNumber": 7
	}, {
		"id": 825,
		"sex": 0,
		"content": "我26，云南，哈哈！是个人就行。",
		"zanNumber": 6
	}, {
		"id": 861,
		"sex": 0,
		"content": "江苏人现居上海，28，171，54。喜欢可爱的女孩，求勾搭",
		"zanNumber": 3
	}
	];

	console.log('dmdata is', dmData)


	const IconGood = './assets/icon-good.png';
	const Avatar = './assets/icon-avatar.png';
	const AvatarBoy = './assets/icon_avatar_boy.png';
	const AvatarGirl = './assets/icon_avatar_girl.png';
	const IconBoy = './assets/icon-boy.png';
	const IconGirl = './assets/icon-girl.png';
	const Banner = './assets/demo-banner.jpg';


	const dmArr = [];

	// 处理弹幕位置
	function setDM() {
		console.log("click function ")
		// 处理弹幕参数
		const _b = dmData;
		for (let i = 0; i < _b.length; i++) {
			const time = Math.floor(Math.random() * 10);
			const _time = time < 6 ? 6 + i : time + i;
			const top = Math.floor(Math.random() * 80) + 2;
			const _p = {
				id: _b[i].id,
				sex: _b[i].sex,
				content: _b[i].content,
				zanNumber: _b[i].zanNumber,
				top,
				time: _time,
			};
			dmArr.push(_p);
		}
	}

	setDM()

	dmArr.map((item, i) => {
		var avatar = document.createElement('img')
		avatar.setAttribute('class', 'avatar')
		avatar.setAttribute('mode', 'aspectFit')
		if (item.sex == 0) {
			avatar.setAttribute("src", AvatarBoy);
		} else {
			avatar.setAttribute("src", AvatarGirl);
		}

		var sex = document.createElement('img')
		sex.setAttribute('class', 'sex')
		sex.setAttribute('mode', 'aspectFit')
		if (item.sex == 0) {
			sex.setAttribute("src", IconBoy);
		} else {
			sex.setAttribute("src", IconGirl);
		}

		var avatarBox = document.createElement('div')
		avatarBox.setAttribute('class', 'avatarBox')

		avatarBox.appendChild(avatar)
		avatarBox.appendChild(sex)

		var content = document.createElement('text')
		content.setAttribute('class', 'content')
		content.innerHTML = item.content

		var dm = document.createElement('div')
		dm.setAttribute('class', 'dm')

		dm.appendChild(avatarBox)
		dm.appendChild(content)

		var dmItem = document.createElement('div')
		dmItem.setAttribute('class', 'dmItem')

		dmItem.appendChild(dm)

		var dmGroup = document.createElement('div');
		dmGroup.setAttribute('class', 'dmGroup');
		// console.log(item.top, item.time, i)
		dmGroup.style.top = item.top + "%";
		let left = 100
		dmGroup.style.left = left + "%";
		let speed = Math.random()
		while (speed > 0.7) {
			speed = Math.random()
		}
		let timer = setInterval(function () {
			if (left < -100) {
				// clearInterval(timer);   	//终止定时器
				left = 100;								// 为了展示效果，不进行暂停，一直循环
			}
			left -= speed;
			dmGroup.style.left = left + "%";
		}.bind(this), 1000 / 70);

		dmGroup.appendChild(dmItem)

		const page = document.getElementById("page")

		page.appendChild(dmGroup)

	})



</script>

</html>